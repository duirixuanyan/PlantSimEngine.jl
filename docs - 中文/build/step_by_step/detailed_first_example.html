<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>详细的第一个模拟 · PlantSimEngine.jl</title><meta name="title" content="详细的第一个模拟 · PlantSimEngine.jl"/><meta property="og:title" content="详细的第一个模拟 · PlantSimEngine.jl"/><meta property="twitter:title" content="详细的第一个模拟 · PlantSimEngine.jl"/><meta name="description" content="Documentation for PlantSimEngine.jl."/><meta property="og:description" content="Documentation for PlantSimEngine.jl."/><meta property="twitter:description" content="Documentation for PlantSimEngine.jl."/><meta property="og:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/step_by_step\\detailed_first_example.html"/><meta property="twitter:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/step_by_step\\detailed_first_example.html"/><link rel="canonical" href="https://VirtualPlantLab.github.io/PlantSimEngine.jl/step_by_step\\detailed_first_example.html"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">PlantSimEngine.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">首页</a></li><li><span class="tocitem">简介</span><ul><li><a class="tocitem" href="../introduction/why_plantsimengine.html">为什么选择 PlantSimEngine？</a></li><li><a class="tocitem" href="../introduction/why_julia.html">为什么选择 Julia？</a></li></ul></li><li><span class="tocitem">前置条件</span><ul><li><a class="tocitem" href="../prerequisites/installing_plantsimengine.html">PlantSimEngine 的安装与运行</a></li><li><a class="tocitem" href="../prerequisites/key_concepts.html">关键概念</a></li><li><a class="tocitem" href="../prerequisites/julia_basics.html">Julia 语言基础</a></li></ul></li><li><span class="tocitem">分步教程 - 单尺度模拟</span><ul><li class="is-active"><a class="tocitem" href="detailed_first_example.html">详细的第一个模拟</a><ul class="internal"><li><a class="tocitem" href="#环境准备"><span>环境准备</span></a></li><li><a class="tocitem" href="#基本概念"><span>基本概念</span></a></li><li><a class="tocitem" href="#参数（Parameters）"><span>参数（Parameters）</span></a></li><li><a class="tocitem" href="#变量（Variables，输入与输出）"><span>变量（Variables，输入与输出）</span></a></li><li><a class="tocitem" href="#气象驱动（Climate-forcing）"><span>气象驱动（Climate forcing）</span></a></li><li><a class="tocitem" href="#模拟"><span>模拟</span></a></li><li><a class="tocitem" href="#模型耦合"><span>模型耦合</span></a></li></ul></li><li><a class="tocitem" href="simple_model_coupling.html">模型耦合</a></li><li><a class="tocitem" href="model_switching.html">模型切换</a></li><li><a class="tocitem" href="quick_and_dirty_examples.html">快速示例</a></li><li><a class="tocitem" href="implement_a_process.html">实现一个过程</a></li><li><a class="tocitem" href="implement_a_model.html">实现一个模型</a></li><li><a class="tocitem" href="parallelization.html">并行化</a></li><li><a class="tocitem" href="advanced_coupling.html">高级耦合与硬依赖</a></li><li><a class="tocitem" href="implement_a_model_additional.html">实现一个模型：补充说明</a></li></ul></li><li><a class="tocitem" href="../model_execution.html">模型执行</a></li><li><span class="tocitem">数据处理</span><ul><li><a class="tocitem" href="../working_with_data/reducing_dof.html">降低自由度</a></li><li><a class="tocitem" href="../working_with_data/fitting.html">拟合</a></li><li><a class="tocitem" href="../working_with_data/inputs.html">输入类型</a></li><li><a class="tocitem" href="../working_with_data/visualising_outputs.html">可视化输出与数据</a></li><li><a class="tocitem" href="../working_with_data/floating_point_accumulation_error.html">浮点运算注意事项</a></li></ul></li><li><span class="tocitem">多尺度建模</span><ul><li><a class="tocitem" href="../multiscale/multiscale_considerations.html">多尺度建模考量</a></li><li><a class="tocitem" href="../multiscale/single_to_multiscale.html">单尺度模型转换为多尺度</a></li><li><a class="tocitem" href="../multiscale/multiscale.html">更多变量映射示例</a></li><li><a class="tocitem" href="../multiscale/multiscale_cyclic.html">循环依赖的处理</a></li><li><a class="tocitem" href="../multiscale/multiscale_coupling.html">多尺度耦合相关说明</a></li><li><input class="collapse-toggle" id="menuitem-7-6" type="checkbox"/><label class="tocitem" for="menuitem-7-6"><span class="docs-label">构建简单植株</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../multiscale/multiscale_example_1.html">简单植株模拟</a></li><li><a class="tocitem" href="../multiscale/multiscale_example_2.html">拓展植株模拟</a></li><li><a class="tocitem" href="../multiscale/multiscale_example_3.html">修复植株模拟中的错误</a></li></ul></li><li><a class="tocitem" href="../multiscale/multiscale_example_4.html">用 PlantGeom 可视化玩具植株</a></li></ul></li><li><span class="tocitem">故障排查与测试</span><ul><li><a class="tocitem" href="../troubleshooting_and_testing/plantsimengine_and_julia_troubleshooting.html">故障排查</a></li><li><a class="tocitem" href="../troubleshooting_and_testing/downstream_tests.html">自动化测试</a></li><li><a class="tocitem" href="../troubleshooting_and_testing/tips_and_workarounds.html">技巧与常见问题</a></li><li><a class="tocitem" href="../troubleshooting_and_testing/implicit_contracts.html">隐性约定</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../API/API_public.html">公共 API</a></li><li><a class="tocitem" href="../API/API_examples.html">示例模型</a></li><li><a class="tocitem" href="../API/API_private.html">内部 API</a></li></ul></li><li><a class="tocitem" href="../documentation_improvement.html">改进文档</a></li><li><a class="tocitem" href="../developers.html">开发者指南</a></li><li><a class="tocitem" href="../planned_features.html">规划功能</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">分步教程 - 单尺度模拟</a></li><li class="is-active"><a href="detailed_first_example.html">详细的第一个模拟</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="detailed_first_example.html">详细的第一个模拟</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/docs - 中文/src/step_by_step/detailed_first_example.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="detailed-walkthrough-of-a-simple-simulation"><a class="docs-heading-anchor" href="#detailed-walkthrough-of-a-simple-simulation">简单模拟的详细演示</a><a id="detailed-walkthrough-of-a-simple-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#detailed-walkthrough-of-a-simple-simulation" title="Permalink"></a></h1><p>本页面将带您深入了解一个基础模拟案例，主要面向编程经验较少的用户，目的是结合先前介绍的概念，展示在具体情境下进行模拟所需的各项要素。</p><p>在本页面下方的<a href="detailed_first_example.html#示例模拟">示例模拟</a>小节可以找到一个经过简化的可运行脚本，其它小节详细说明了设置、辅助函数和如何查询输出结果。</p><p>如果您只是想复制粘贴范例并做些尝试，可以直接前往<a href="quick_and_dirty_examples.html#快速示例">快速示例</a>页面查阅多个案例。</p><ul><li><a href="detailed_first_example.html#detailed-walkthrough-of-a-simple-simulation">简单模拟的详细演示</a></li><li class="no-marker"><ul><li><a href="detailed_first_example.html#环境准备">环境准备</a></li><li><a href="detailed_first_example.html#基本概念">基本概念</a></li><li class="no-marker"><ul><li><a href="detailed_first_example.html#过程-(Processes)">过程 (Processes)</a></li><li><a href="detailed_first_example.html#模型（ModelList）">模型（ModelList）</a></li></ul></li><li><a href="detailed_first_example.html#参数（Parameters）">参数（Parameters）</a></li><li><a href="detailed_first_example.html#变量（Variables，输入与输出）">变量（Variables，输入与输出）</a></li><li><a href="detailed_first_example.html#气象驱动（Climate-forcing）">气象驱动（Climate forcing）</a></li><li><a href="detailed_first_example.html#模拟">模拟</a></li><li class="no-marker"><ul><li><a href="detailed_first_example.html#过程模拟">过程模拟</a></li><li><a href="detailed_first_example.html#示例模拟">示例模拟</a></li><li><a href="detailed_first_example.html#输出">输出</a></li></ul></li><li><a href="detailed_first_example.html#模型耦合">模型耦合</a></li></ul></li></ul><h2 id="环境准备"><a class="docs-heading-anchor" href="#环境准备">环境准备</a><a id="环境准备-1"></a><a class="docs-heading-anchor-permalink" href="#环境准备" title="Permalink"></a></h2><p>在本手册涉及的所有脚本中，您都需要一个已安装 PlantSimEngine 的正常 Julia 环境，通常还需添加若干配套包。具体安装与运行方法详见<a href="../prerequisites/installing_plantsimengine.html#PlantSimEngine-的安装与运行">PlantSimEngine 的安装与运行</a>页面。</p><h2 id="基本概念"><a class="docs-heading-anchor" href="#基本概念">基本概念</a><a id="基本概念-1"></a><a class="docs-heading-anchor-permalink" href="#基本概念" title="Permalink"></a></h2><h3 id="过程-(Processes)"><a class="docs-heading-anchor" href="#过程-(Processes)">过程 (Processes)</a><a id="过程-(Processes)-1"></a><a class="docs-heading-anchor-permalink" href="#过程-(Processes)" title="Permalink"></a></h3><p>在本包中，“过程”定义了某种生物或物理现象。可以将其类比为系统中发生的各种活动，如：光截获、光合作用、水分交换、碳与能量流、生长、产量，乃至太阳能电池板发电等。</p><p>“声明”一个过程意味着我们对其做出定义，并实现对应的模型用于模拟。在本例中，我们使用了已定义好并实现了对应模型的过程。</p><h3 id="模型（ModelList）"><a class="docs-heading-anchor" href="#模型（ModelList）">模型（ModelList）</a><a id="模型（ModelList）-1"></a><a class="docs-heading-anchor-permalink" href="#模型（ModelList）" title="Permalink"></a></h3><p>每个过程都需要通过特定的实现方式——即<strong>模型</strong>（model）来进行模拟。每个模型都通过一个结构体来实现，并在结构体中列出了该模型的参数。例如，PlantBiophysics 包提供了<a href="https://vezy.github.io/PlantBiophysics.jl/stable/functions/#PlantBiophysics.Beer"><code>Beer</code></a>结构体，用于实现描述光衰减的 Beer-Lambert 定律。在本包中，<code>light_interception</code>（光截获过程）及其所用的 <code>Beer</code> 模型，也作为示例脚本包含在<a href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/master/examples/Beer.jl"><code>examples/Beer.jl</code></a>文件中。</p><p>模型可包含如下内容：</p><ul><li>参数（Parameters）</li><li>气象信息（Meteorological information）</li><li>变量（Variables）</li><li>常量（Constants）</li><li>额外信息（Extras）</li></ul><p><strong>参数</strong> 是模型内部用于计算输出的常量，仅在该模型内部使用。   <strong>气象信息</strong> 由用户提供，作为模型输入，定义每个时间步的环境条件，<code>PlantSimEngine.jl</code> 会自动为每个时间步应用这些信息。   <strong>变量</strong> 包含模型所用或计算得到的数据，可选地在模拟前初始化。变量可以在多个模型中流转——由一个模型计算，再被另一个模型使用；也可以作为全局输出或在模拟开始时由用户指定。   <strong>常量</strong> 是常量参数，通常为各模型公用，如气体常数等。   <strong>额外信息（extras）</strong> 可作为模型备用信息或者做为内部数据的占位。</p><p>用户需声明用于模拟的一组模型，以及每个模型所需的参数和应初始化的变量。其操作结构为<a href="simple_model_coupling.html#ModelList"><code>ModelList</code></a>。</p><p>例如，下面通过 <code>ModelList</code> 结构体声明一个仅含 Beer-Lambert 光截获模型的模型组。该模型由 <a href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/master/examples/Beer.jl"><code>Beer</code></a> 结构实现，并且只含一个参数——消光系数（<code>k</code>）。</p><p>导入主包：</p><pre><code class="language-julia hljs">using PlantSimEngine</code></pre><p>再导入<a href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/examples"><code>Examples</code></a>子模块中定义的示例（如 <code>light_interception</code> 和 <code>Beer</code>）：</p><pre><code class="language-julia hljs">using PlantSimEngine.Examples</code></pre><p>然后，使用 <code>Beer</code> 模型来声明一个 <a href="simple_model_coupling.html#ModelList"><code>ModelList</code></a> ：</p><pre><code class="language-julia hljs">m = ModelList(Beer(0.5))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">╭──── </span>Dependency graph (1 models)<span class="sgr2"> ─────────────────────────────────────────────────────────────────╮</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">╭──── </span></span>light_interception<span class="sgr32"><span class="sgr2"> ────────────────────────────────────────────────────────────────────╮</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">╭──── </span></span>Main model<span class="sgr34"><span class="sgr2"> ──────────────────────────────────────────────────────────────────────╮</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">│</span></span>  Process: light_interception                                                         <span class="sgr34"><span class="sgr2">│</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">│</span></span>  Model: PlantSimEngine.Examples.Beer                                                 <span class="sgr34"><span class="sgr2">│</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">│</span></span>  Dep: nothing                                                                        <span class="sgr34"><span class="sgr2">│</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">╰──────────────────────────────────────────────────────────────────────────────────────╯</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">╰────────────────────────────────────────────────────────────────────────────────────────────╯</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span></span></span>

<span class="sgr31">╭──── </span>Status<span class="sgr31"> ──────────────────────────────────────────────────────────────────────────╮</span>
<span class="sgr31">│</span>  LAI<span class="sgr38_2" style="color:#ef5350">=-</span>Inf, aPPFD<span class="sgr38_2" style="color:#ef5350">=-</span>Inf                                                                <span class="sgr31">│</span>
<span class="sgr31">╰──────────────────────────────────────────────────────────────────────────────────────╯</span>
</code></pre><p>发生了什么？我们把 <code>Beer</code> 模型的实例提供给了 <code>ModelList</code>，用以模拟光截获过程。</p><h2 id="参数（Parameters）"><a class="docs-heading-anchor" href="#参数（Parameters）">参数（Parameters）</a><a id="参数（Parameters）-1"></a><a class="docs-heading-anchor-permalink" href="#参数（Parameters）" title="Permalink"></a></h2><p>参数（Parameter）是在模型内部用于模拟计算且在模拟过程中保持不变的数值。例如，Beer-Lambert 模型使用消光系数（<code>k</code>）来计算光的衰减。具体来说，Beer-Lambert 模型实现中的 <code>Beer</code> 结构体只有一个字段：<code>k</code>。我们可以通过对模型结构体使用 <code>fieldnames</code> 来查看这一点：</p><pre><code class="language-julia hljs">fieldnames(Beer)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(:k,)</code></pre><h2 id="变量（Variables，输入与输出）"><a class="docs-heading-anchor" href="#变量（Variables，输入与输出）">变量（Variables，输入与输出）</a><a id="变量（Variables，输入与输出）-1"></a><a class="docs-heading-anchor-permalink" href="#变量（Variables，输入与输出）" title="Permalink"></a></h2><p>变量可作为模型的输入或输出（即被模型计算得到）。变量及其数值都存储在<a href="simple_model_coupling.html#ModelList"><code>ModelList</code></a>结构体中，可以自动或手动初始化。</p><p>例如，<code>Beer</code> 模型需要叶面积指数 (<code>LAI</code>, m²/m²) 作为输入。</p><p>可使用 <a href="../API/API_public.html#PlantSimEngine.inputs-Tuple{T} where T&lt;:AbstractModel"><code>inputs</code></a> 查看模型的输入变量：</p><pre><code class="language-julia hljs">inputs(Beer(0.5))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(:LAI,)</code></pre><p>用 <a href="../API/API_public.html#PlantSimEngine.outputs-Tuple{T} where T&lt;:AbstractModel"><code>outputs</code></a> 可以查看模型的输出变量：</p><pre><code class="language-julia hljs">outputs(Beer(0.5))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(:aPPFD,)</code></pre><p><a href="simple_model_coupling.html#ModelList"><code>ModelList</code></a> 会在模拟运行期间维护每个变量的当前状态，保存在字段 <code>status</code> 中。我们可以利用 <a href="../API/API_public.html#PlantSimEngine.status-Tuple{Any}"><code>status</code></a> 函数查看，例如本例中可见两个变量：<code>LAI</code> 和 <code>aPPFD</code>。前者为输入，后者为输出。</p><pre><code class="language-julia hljs">m = ModelList(Beer(0.5))
keys(status(m))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(:LAI, :aPPFD)</code></pre><p>要确定哪些变量需要初始化，可用<a href="../API/API_public.html#PlantSimEngine.to_initialize-Tuple{ModelList}"><code>to_initialize</code></a>：</p><pre><code class="language-julia hljs">m = ModelList(Beer(0.5))
to_initialize(m)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(light_interception = (:LAI,),)</code></pre><p>这些变量尚未初始化（因此会出现警告）：</p><pre><code class="language-julia hljs">(m[:LAI], m[:aPPFD])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(-Inf, -Inf)</code></pre><p>未初始化变量的初值由模型代码中的 <a href="../API/API_public.html#PlantSimEngine.inputs-Tuple{T} where T&lt;:AbstractModel"><code>inputs</code></a> 或 <a href="../API/API_public.html#PlantSimEngine.outputs-Tuple{T} where T&lt;:AbstractModel"><code>outputs</code></a> 方法赋予，通常等于类型的最小值，比如 <code>Float64</code> 类型的 <code>-Inf</code>。</p><div class="admonition is-success" id="Tip-c191ff99904fa1d1"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-c191ff99904fa1d1" title="Permalink"></a></header><div class="admonition-body"><p>推荐使用<a href="../API/API_public.html#PlantSimEngine.to_initialize-Tuple{ModelList}"><code>to_initialize</code></a> 而不是 <a href="../API/API_public.html#PlantSimEngine.inputs-Tuple{T} where T&lt;:AbstractModel"><code>inputs</code></a> 检查应初始化哪些变量。前者只返回<strong>需要且未初始化</strong>的变量，后者则返回模型需要的所有输入变量。在多模型耦合场景下，有些输入实际可由其它模型计算而无需初始化。</p></div></div><p>初始化变量时，可在声明 ModelList 时直接赋值：</p><pre><code class="language-julia hljs">m = ModelList(Beer(0.5), status = (LAI = 2.0,))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">╭──── </span>Dependency graph (1 models)<span class="sgr2"> ─────────────────────────────────────────────────────────────────╮</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">╭──── </span></span>light_interception<span class="sgr32"><span class="sgr2"> ────────────────────────────────────────────────────────────────────╮</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">╭──── </span></span>Main model<span class="sgr34"><span class="sgr2"> ──────────────────────────────────────────────────────────────────────╮</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">│</span></span>  Process: light_interception                                                         <span class="sgr34"><span class="sgr2">│</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">│</span></span>  Model: PlantSimEngine.Examples.Beer                                                 <span class="sgr34"><span class="sgr2">│</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">│</span></span>  Dep: nothing                                                                        <span class="sgr34"><span class="sgr2">│</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr34"><span class="sgr2">╰──────────────────────────────────────────────────────────────────────────────────────╯</span></span>  <span class="sgr32"><span class="sgr2">│</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>  <span class="sgr32"><span class="sgr2">╰────────────────────────────────────────────────────────────────────────────────────────────╯</span></span>  <span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">│</span></span></span>
<span class="sgr38_2" style="color:#ffa726"><span class="sgr3"><span class="sgr2">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span></span></span>

<span class="sgr31">╭──── </span>Status<span class="sgr31"> ──────────────────────────────────────────────────────────────────────────╮</span>
<span class="sgr31">│</span>  LAI<span class="sgr38_2" style="color:#ef5350">=</span><span class="sgr38_2" style="color:#90caf9">2.0</span>, aPPFD<span class="sgr38_2" style="color:#ef5350">=-</span>Inf                                                                 <span class="sgr31">│</span>
<span class="sgr31">╰──────────────────────────────────────────────────────────────────────────────────────╯</span>
</code></pre><p>也可在实例化后用 <a href="../API/API_public.html#PlantSimEngine.init_status!-Tuple{Dict{String, ModelList}}"><code>init_status!</code></a> 赋值：</p><pre><code class="language-julia hljs">m = ModelList(Beer(0.5))

init_status!(m, LAI = 2.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Some variables must be initialized before simulation: (light_interception = (:LAI,),) (see `to_initialize()`)</code></pre><p>可调用<a href="../API/API_public.html#PlantSimEngine.is_initialized-Tuple{T} where T&lt;:ModelList"><code>is_initialized</code></a> 检查组件是否正确初始化：</p><pre><code class="language-julia hljs">is_initialized(m)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>有些变量作为输入参数，但实际上由其它模型输出。当多个模型耦合时，<a href="../API/API_public.html#PlantSimEngine.to_initialize-Tuple{ModelList}"><code>to_initialize</code></a> 只会请求未被其他模型计算的变量。</p><h2 id="气象驱动（Climate-forcing）"><a class="docs-heading-anchor" href="#气象驱动（Climate-forcing）">气象驱动（Climate forcing）</a><a id="气象驱动（Climate-forcing）-1"></a><a class="docs-heading-anchor-permalink" href="#气象驱动（Climate-forcing）" title="Permalink"></a></h2><p>进行模拟时一般需要测量对象或组件周围的气象条件。</p><p>强烈推荐配合使用 <a href="https://github.com/PalmStudio/PlantMeteo.jl"><code>PlantMeteo.jl</code></a> 包，其内置高效的数据结构与预处理功能，可便捷管理气象数据。该包的基本气象结构体叫 <a href="https://palmstudio.github.io/PlantMeteo.jl/stable/#PlantMeteo.Atmosphere"><code>Atmosphere</code></a>，表示稳态（平衡）大气条件。若有多个时间步数据，可用 <a href="https://palmstudio.github.io/PlantMeteo.jl/stable/#PlantMeteo.TimeStepTable"><code>TimeStepTable</code></a>。</p><p>声明 <a href="https://palmstudio.github.io/PlantMeteo.jl/stable/#PlantMeteo.Atmosphere"><code>Atmosphere</code></a> 时必须指定如下变量：<code>T</code>（气温℃）、<code>Rh</code>（相对湿度0-1）、<code>Wind</code>（风速m/s）。在本例中还需给出光合有效辐射通量（<code>Ri_PAR_f</code>, W/m²）。示例如下：</p><pre><code class="language-julia hljs">using PlantMeteo
meteo = Atmosphere(T = 20.0, Wind = 1.0, Rh = 0.65, Ri_PAR_f = 500.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Atmosphere(date = Dates.DateTime(&quot;2026-01-10T19:41:13.219&quot;), duration = Dates.Second(1), T = 20.0, Wind = 1.0, P = 101.325, Rh = 0.65, Precipitations = 0.0, Cₐ = 400.0, e = 1.5255470730405223, eₛ = 2.3469954969854188, VPD = 0.8214484239448965, ρ = 1.2040822421461452, λ = 2.4537e6, γ = 0.06725339460440805, ε = 0.5848056484857892, Δ = 0.14573378083416522, clearness = Inf, Ri_SW_f = Inf, Ri_PAR_f = 500.0, Ri_NIR_f = Inf, Ri_TIR_f = Inf, Ri_custom_f = Inf)</code></pre><p>上述例子中，<code>meteo</code> 就是可用于模拟的单一气象时段数据。</p><p>更多细节可查看<a href="https://vezy.github.io/PlantMeteo.jl/stable">包文档</a>。</p><h2 id="模拟"><a class="docs-heading-anchor" href="#模拟">模拟</a><a id="模拟-1"></a><a class="docs-heading-anchor-permalink" href="#模拟" title="Permalink"></a></h2><h3 id="过程模拟"><a class="docs-heading-anchor" href="#过程模拟">过程模拟</a><a id="过程模拟-1"></a><a class="docs-heading-anchor-permalink" href="#过程模拟" title="Permalink"></a></h3><p>运行模拟时，可在 <a href="simple_model_coupling.html#ModelList"><code>ModelList</code></a> 上调用 <a href="../API/API_public.html#PlantSimEngine.run!"><code>run!</code></a> 方法。如需输入多步气象数据，也可将其作为可选参数传入。</p><p>调用方式如下：</p><pre><code class="language-julia hljs">run!(model_list, meteo)</code></pre><p>第一个参数是模型组（见<a href="simple_model_coupling.html#ModelList"><code>ModelList</code></a>），第二个参数是微气候条件。</p><p>调用前应确保<a href="simple_model_coupling.html#ModelList"><code>ModelList</code></a> 已为该过程完成初始化，可回顾前述<a href="implement_a_model.html#输入与输出">输入与输出</a>部分。</p><h3 id="示例模拟"><a class="docs-heading-anchor" href="#示例模拟">示例模拟</a><a id="示例模拟-1"></a><a class="docs-heading-anchor-permalink" href="#示例模拟" title="Permalink"></a></h3><p>例如，下面模拟单片叶片的“光截获”过程：</p><pre><code class="language-julia hljs">using PlantSimEngine, PlantMeteo

# 导入 `Examples` 子模块中的示例
using PlantSimEngine.Examples

meteo = Atmosphere(T = 20.0, Wind = 1.0, Rh = 0.65, Ri_PAR_f = 500.0)

leaf = ModelList(Beer(0.5), status = (LAI = 2.0,))

outputs_example = run!(leaf, meteo)

outputs_example[:aPPFD]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{Float64}:
 1444.3954769232544</code></pre><h3 id="输出"><a class="docs-heading-anchor" href="#输出">输出</a><a id="输出-1"></a><a class="docs-heading-anchor-permalink" href="#输出" title="Permalink"></a></h3><p><a href="simple_model_coupling.html#ModelList"><code>ModelList</code></a> 的<a href="../API/API_public.html#PlantSimEngine.status-Tuple{Any}"><code>status</code></a> 字段，用于在模拟前初始化变量，也能实时追踪模拟过程中及最后的变量取值。调用 <a href="../API/API_public.html#PlantSimEngine.status-Tuple{Any}"><code>status</code></a> 可获得最终时间步的输出结果。</p><p>而 <a href="../API/API_public.html#PlantSimEngine.run!"><code>run!</code></a> 方法返回的是完整的模拟所有步长的输出数据。通常输出采用 <code>PlantMeteo.jl</code> 的 <a href="../API/API_public.html#PlantMeteo.TimeStepTable-Union{Tuple{DataFrame}, Tuple{Status}, Tuple{DataFrame, Any}} where Status"><code>TimeStepTable</code></a> 结构（类似 DataFrame，但每行为一个 <a href="../API/API_public.html#PlantSimEngine.Status"><code>Status</code></a>），当然也支持 <code>Tables.jl</code> 的其它结构如常规 DataFrame。气象数据同理，默认也支持 <a href="../API/API_public.html#PlantMeteo.TimeStepTable-Union{Tuple{DataFrame}, Tuple{Status}, Tuple{DataFrame, Any}} where Status"><code>TimeStepTable</code></a>，每行为一个 <code>Atmosphere</code>。</p><p>本例只用了单一气象时段，因此 <a href="../API/API_public.html#PlantSimEngine.run!"><code>run!</code></a> 返回值和模型组的 <a href="../API/API_public.html#PlantSimEngine.status-Tuple{Any}"><code>status</code></a> 字段内容相同。</p><p>现在查看前面叶片模拟的输出结构：</p><p>可用索引读取具体变量的值，比如截获的光合有效光：</p><pre><code class="language-julia hljs">outputs_example[:aPPFD]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{Float64}:
 1444.3954769232544</code></pre><p>也可以用点语法读取：</p><pre><code class="language-julia hljs">outputs_example.aPPFD</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{Float64}:
 1444.3954769232544</code></pre><p>您可以将输出打印、转为其它格式或用 Julia 其它绘图库直接可视化。具体方法请参考<a href="../working_with_data/visualising_outputs.html#输出和数据可视化">输出和数据可视化</a>页面。</p><p>另一种便捷输出方法是将结果转为 DataFrame，因为 <a href="../API/API_public.html#PlantMeteo.TimeStepTable-Union{Tuple{DataFrame}, Tuple{Status}, Tuple{DataFrame, Any}} where Status"><code>TimeStepTable</code></a> 实现了 Tables.jl 接口，这非常容易：</p><pre><code class="language-julia hljs">using DataFrames
convert_outputs(outputs_example, DataFrame)</code></pre><div><div style = "float: left;"><span>1×2 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">LAI</th><th style = "text-align: left;">aPPFD</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">2.0</td><td style = "text-align: right;">1444.4</td></tr></tbody></table></div><h2 id="模型耦合"><a class="docs-heading-anchor" href="#模型耦合">模型耦合</a><a id="模型耦合-1"></a><a class="docs-heading-anchor-permalink" href="#模型耦合" title="Permalink"></a></h2><p>模型既可单独工作，也可联合运行。例如气孔导度模型通常与光合模型耦合使用（由光合模型调用）。</p><p>PlantSimEngine.jl 特别设计以方便建模与用户无痛实现模型耦合。更多详细说明请参阅<a href="simple_model_coupling.html#标准模型耦合">标准模型耦合</a>、<a href="advanced_coupling.html#耦合更复杂的模型">耦合更复杂的模型</a>，以及<a href="../multiscale/multiscale_coupling.html#多尺度环境下的依赖关系处理">多尺度环境下的依赖关系处理</a>。</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../prerequisites/julia_basics.html">« Julia 语言基础</a><a class="docs-footer-nextpage" href="simple_model_coupling.html">模型耦合 »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 10 January 2026 19:42">Saturday 10 January 2026</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
