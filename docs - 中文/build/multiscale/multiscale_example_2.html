<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>拓展植株模拟 · PlantSimEngine.jl</title><meta name="title" content="拓展植株模拟 · PlantSimEngine.jl"/><meta property="og:title" content="拓展植株模拟 · PlantSimEngine.jl"/><meta property="twitter:title" content="拓展植株模拟 · PlantSimEngine.jl"/><meta name="description" content="Documentation for PlantSimEngine.jl."/><meta property="og:description" content="Documentation for PlantSimEngine.jl."/><meta property="twitter:description" content="Documentation for PlantSimEngine.jl."/><meta property="og:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale\\multiscale_example_2.html"/><meta property="twitter:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale\\multiscale_example_2.html"/><link rel="canonical" href="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale\\multiscale_example_2.html"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">PlantSimEngine.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">首页</a></li><li><span class="tocitem">简介</span><ul><li><a class="tocitem" href="../introduction/why_plantsimengine.html">为什么选择 PlantSimEngine？</a></li><li><a class="tocitem" href="../introduction/why_julia.html">为什么选择 Julia？</a></li></ul></li><li><span class="tocitem">前置条件</span><ul><li><a class="tocitem" href="../prerequisites/installing_plantsimengine.html">PlantSimEngine 的安装与运行</a></li><li><a class="tocitem" href="../prerequisites/key_concepts.html">关键概念</a></li><li><a class="tocitem" href="../prerequisites/julia_basics.html">Julia 语言基础</a></li></ul></li><li><span class="tocitem">分步教程 - 单尺度模拟</span><ul><li><a class="tocitem" href="../step_by_step/detailed_first_example.html">详细的第一个模拟</a></li><li><a class="tocitem" href="../step_by_step/simple_model_coupling.html">模型耦合</a></li><li><a class="tocitem" href="../step_by_step/model_switching.html">模型切换</a></li><li><a class="tocitem" href="../step_by_step/quick_and_dirty_examples.html">快速示例</a></li><li><a class="tocitem" href="../step_by_step/implement_a_process.html">实现一个过程</a></li><li><a class="tocitem" href="../step_by_step/implement_a_model.html">实现一个模型</a></li><li><a class="tocitem" href="../step_by_step/parallelization.html">并行化</a></li><li><a class="tocitem" href="../step_by_step/advanced_coupling.html">高级耦合与硬依赖</a></li><li><a class="tocitem" href="../step_by_step/implement_a_model_additional.html">实现一个模型：补充说明</a></li></ul></li><li><a class="tocitem" href="../model_execution.html">模型执行</a></li><li><span class="tocitem">数据处理</span><ul><li><a class="tocitem" href="../working_with_data/reducing_dof.html">降低自由度</a></li><li><a class="tocitem" href="../working_with_data/fitting.html">拟合</a></li><li><a class="tocitem" href="../working_with_data/inputs.html">输入类型</a></li><li><a class="tocitem" href="../working_with_data/visualising_outputs.html">可视化输出与数据</a></li><li><a class="tocitem" href="../working_with_data/floating_point_accumulation_error.html">浮点运算注意事项</a></li></ul></li><li><span class="tocitem">多尺度建模</span><ul><li><a class="tocitem" href="multiscale_considerations.html">多尺度建模考量</a></li><li><a class="tocitem" href="single_to_multiscale.html">单尺度模型转换为多尺度</a></li><li><a class="tocitem" href="multiscale.html">更多变量映射示例</a></li><li><a class="tocitem" href="multiscale_cyclic.html">循环依赖的处理</a></li><li><a class="tocitem" href="multiscale_coupling.html">多尺度耦合相关说明</a></li><li><input class="collapse-toggle" id="menuitem-7-6" type="checkbox" checked/><label class="tocitem" for="menuitem-7-6"><span class="docs-label">构建简单植株</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="multiscale_example_1.html">简单植株模拟</a></li><li class="is-active"><a class="tocitem" href="multiscale_example_2.html">拓展植株模拟</a><ul class="internal"><li><a class="tocitem" href="#初始化设置"><span>初始化设置</span></a></li><li><a class="tocitem" href="#给植物添加根"><span>给植物添加根</span></a></li><li><a class="tocitem" href="#根系相关的模型"><span>根系相关的模型</span></a></li><li><a class="tocitem" href="#更新其他模型以考虑水分"><span>更新其他模型以考虑水分</span></a></li><li><a class="tocitem" href="#更新映射关系"><span>更新映射关系</span></a></li><li><a class="tocitem" href="#运行模拟"><span>运行模拟</span></a></li></ul></li><li><a class="tocitem" href="multiscale_example_3.html">修复植株模拟中的错误</a></li></ul></li><li><a class="tocitem" href="multiscale_example_4.html">用 PlantGeom 可视化玩具植株</a></li></ul></li><li><span class="tocitem">故障排查与测试</span><ul><li><a class="tocitem" href="../troubleshooting_and_testing/plantsimengine_and_julia_troubleshooting.html">故障排查</a></li><li><a class="tocitem" href="../troubleshooting_and_testing/downstream_tests.html">自动化测试</a></li><li><a class="tocitem" href="../troubleshooting_and_testing/tips_and_workarounds.html">技巧与常见问题</a></li><li><a class="tocitem" href="../troubleshooting_and_testing/implicit_contracts.html">隐性约定</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../API/API_public.html">公共 API</a></li><li><a class="tocitem" href="../API/API_examples.html">示例模型</a></li><li><a class="tocitem" href="../API/API_private.html">内部 API</a></li></ul></li><li><a class="tocitem" href="../documentation_improvement.html">改进文档</a></li><li><a class="tocitem" href="../developers.html">开发者指南</a></li><li><a class="tocitem" href="../planned_features.html">规划功能</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">多尺度建模</a></li><li><a class="is-disabled">构建简单植株</a></li><li class="is-active"><a href="multiscale_example_2.html">拓展植株模拟</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="multiscale_example_2.html">拓展植株模拟</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/docs - 中文/src/multiscale/multiscale_example_2.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="扩展多尺度模拟"><a class="docs-heading-anchor" href="#扩展多尺度模拟">扩展多尺度模拟</a><a id="扩展多尺度模拟-1"></a><a class="docs-heading-anchor-permalink" href="#扩展多尺度模拟" title="Permalink"></a></h1><p>让我们在前一个示例的基础上，增加一些新的器官生长，并在两者之间引入非常轻微的耦合。</p><p>本节完整模拟脚本可在 examples 文件夹下的 <a href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/examples/ToyMultiScalePlantModel/ToyPlantSimulation2.jl">ToyMultiScalePlantModel</a> 子目录中找到。</p><ul><li><a href="multiscale_example_2.html#扩展多尺度模拟">扩展多尺度模拟</a></li><li class="no-marker"><ul><li><a href="multiscale_example_2.html#初始化设置">初始化设置</a></li><li><a href="multiscale_example_2.html#给植物添加根">给植物添加根</a></li><li><a href="multiscale_example_2.html#根系相关的模型">根系相关的模型</a></li><li class="no-marker"><ul><li><a href="multiscale_example_2.html#水分吸收">水分吸收</a></li><li><a href="multiscale_example_2.html#根生长">根生长</a></li></ul></li><li><a href="multiscale_example_2.html#更新其他模型以考虑水分">更新其他模型以考虑水分</a></li><li class="no-marker"><ul><li><a href="multiscale_example_2.html#资源存储">资源存储</a></li><li><a href="multiscale_example_2.html#节间生长">节间生长</a></li></ul></li><li><a href="multiscale_example_2.html#更新映射关系">更新映射关系</a></li><li><a href="multiscale_example_2.html#运行模拟">运行模拟</a></li></ul></li></ul><h2 id="初始化设置"><a class="docs-heading-anchor" href="#初始化设置">初始化设置</a><a id="初始化设置-1"></a><a class="docs-heading-anchor-permalink" href="#初始化设置" title="Permalink"></a></h2><p>同样，确保已正确设置好 Julia 环境：</p><pre><code class="language-julia hljs">using PlantSimEngine
using PlantSimEngine.Examples
using PlantMeteo
using MultiScaleTreeGraph
using CSV, DataFrames

PlantSimEngine.@process &quot;leaf_carbon_capture&quot; verbose = false

struct ToyLeafCarbonCaptureModel&lt;: AbstractLeaf_Carbon_CaptureModel end

function PlantSimEngine.inputs_(::ToyLeafCarbonCaptureModel)
    NamedTuple() # 无需输入
end

function PlantSimEngine.outputs_(::ToyLeafCarbonCaptureModel)
    (carbon_captured=0.0,)
end

function PlantSimEngine.run!(::ToyLeafCarbonCaptureModel, models, status, meteo, constants, extra)
    status.carbon_captured = 40
end

function get_n_leaves(node::MultiScaleTreeGraph.Node)
    root = MultiScaleTreeGraph.get_root(node)
    nleaves = length(MultiScaleTreeGraph.traverse(root, x-&gt;1, symbol=&quot;Leaf&quot;))
    return nleaves
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">get_n_leaves (generic function with 1 method)</code></pre><h2 id="给植物添加根"><a class="docs-heading-anchor" href="#给植物添加根">给植物添加根</a><a id="给植物添加根-1"></a><a class="docs-heading-anchor-permalink" href="#给植物添加根" title="Permalink"></a></h2><p>我们将为植物添加一个根，该根能够吸收水分并将其加入到水分库中。由于初始水分存量较低，因此会优先进行根的生长，之后植物像之前一样同时生长叶片和新的节间。根的生长有最大长度限制，且不会分枝。</p><p>这导致我们需要在映射中加入一个新的尺度 &quot;Root&quot;，并新增两个模型：一个用于水分吸收，一个用于根生长。同时，为了考虑水分，其他的一些模型也需要进行相应的更新。碳捕获模型保持不变，<code>get_n_leaves</code> 这个辅助函数同样无需修改。</p><h2 id="根系相关的模型"><a class="docs-heading-anchor" href="#根系相关的模型">根系相关的模型</a><a id="根系相关的模型-1"></a><a class="docs-heading-anchor-permalink" href="#根系相关的模型" title="Permalink"></a></h2><h3 id="水分吸收"><a class="docs-heading-anchor" href="#水分吸收">水分吸收</a><a id="水分吸收-1"></a><a class="docs-heading-anchor-permalink" href="#水分吸收" title="Permalink"></a></h3><p>让我们实现一个非常简化的根系水分吸收模型。该模型通过天气数据中的降水量，并乘以某个吸收系数，计算根系吸收的水分量。</p><pre><code class="language-julia hljs">PlantSimEngine.@process &quot;water_absorption&quot; verbose = false

struct ToyWaterAbsorptionModel &lt;: AbstractWater_AbsorptionModel
end

PlantSimEngine.inputs_(::ToyWaterAbsorptionModel) = (root_water_assimilation=1.0,)
PlantSimEngine.outputs_(::ToyWaterAbsorptionModel) = (water_absorbed=0.0,)

function PlantSimEngine.run!(m::ToyWaterAbsorptionModel, models, status, meteo, constants=nothing, extra=nothing)
    status.water_absorbed = meteo.Precipitations * status.root_water_assimilation
end</code></pre><h3 id="根生长"><a class="docs-heading-anchor" href="#根生长">根生长</a><a id="根生长-1"></a><a class="docs-heading-anchor-permalink" href="#根生长" title="Permalink"></a></h3><p>根生长模型与节间生长模型类似：它会检查水分是否低于阈值，并确保碳存量足够。当根的总长度尚未达到最大值时，会在MTG中添加一个新的器官。</p><p>同时，也会用到两个辅助函数：分别用于寻找根的末端，并计算根的长度：</p><pre><code class="language-julia hljs">function get_root_end_node(node::MultiScaleTreeGraph.Node)
    root = MultiScaleTreeGraph.get_root(node)
    return MultiScaleTreeGraph.traverse(root, x-&gt;x, symbol=&quot;Root&quot;, filter_fun = MultiScaleTreeGraph.isleaf)
end

function get_roots_count(node::MultiScaleTreeGraph.Node)
    root = MultiScaleTreeGraph.get_root(node)
    return length(MultiScaleTreeGraph.traverse(root, x-&gt;x, symbol=&quot;Root&quot;))
end

PlantSimEngine.@process &quot;root_growth&quot; verbose = false

struct ToyRootGrowthModel{T} &lt;: AbstractRoot_GrowthModel
    water_threshold::T
    carbon_root_creation_cost::T
    root_max_len::Int
end

PlantSimEngine.inputs_(::ToyRootGrowthModel) = (water_stock=0.0,carbon_stock=0.0,)
PlantSimEngine.outputs_(::ToyRootGrowthModel) = (carbon_root_creation_consumed=0.0,)

function PlantSimEngine.run!(m::ToyRootGrowthModel, models, status, meteo, constants=nothing, extra=nothing)
    if status.water_stock &lt; m.water_threshold &amp;&amp; status.carbon_stock &gt; m.carbon_root_creation_cost

        root_end = get_root_end_node(status.node)

        if length(root_end) != 1
            throw(AssertionError(&quot;未能找到符号为\&quot;Root\&quot;的MTG叶节点&quot;))
        end
        root_len = get_roots_count(root_end[1])
        if root_len &lt; m.root_max_len
            st = add_organ!(root_end[1], extra, &quot;&lt;&quot;, &quot;Root&quot;, 2, index=1)
            status.carbon_root_creation_consumed = m.carbon_root_creation_cost
        end
    else
        status.carbon_root_creation_consumed = 0.0
    end
end</code></pre><h2 id="更新其他模型以考虑水分"><a class="docs-heading-anchor" href="#更新其他模型以考虑水分">更新其他模型以考虑水分</a><a id="更新其他模型以考虑水分-1"></a><a class="docs-heading-anchor-permalink" href="#更新其他模型以考虑水分" title="Permalink"></a></h2><h3 id="资源存储"><a class="docs-heading-anchor" href="#资源存储">资源存储</a><a id="资源存储-1"></a><a class="docs-heading-anchor-permalink" href="#资源存储" title="Permalink"></a></h3><p>吸收的水分现在需要被累积，并且还需考虑根系碳创建的消耗。</p><pre><code class="language-julia hljs">PlantSimEngine.@process &quot;resource_stock_computation&quot; verbose = false

struct ToyStockComputationModel &lt;: AbstractResource_Stock_ComputationModel
end

PlantSimEngine.inputs_(::ToyStockComputationModel) =
(water_absorbed=0.0, carbon_captured=0.0, carbon_organ_creation_consumed=0.0, carbon_root_creation_consumed=0.0)

PlantSimEngine.outputs_(::ToyStockComputationModel) = (water_stock=-Inf, carbon_stock=-Inf)

function PlantSimEngine.run!(m::ToyStockComputationModel, models, status, meteo, constants=nothing, extra=nothing)
    status.water_stock += sum(status.water_absorbed)
    status.carbon_stock += sum(status.carbon_captured) - sum(status.carbon_organ_creation_consumed) - sum(status.carbon_root_creation_consumed)
end</code></pre><h3 id="节间生长"><a class="docs-heading-anchor" href="#节间生长">节间生长</a><a id="节间生长-1"></a><a class="docs-heading-anchor-permalink" href="#节间生长" title="Permalink"></a></h3><p>这里的小改动是：新器官的创建现在只有在水分库存高于给定阈值时才会发生。</p><pre><code class="language-julia hljs">struct ToyCustomInternodeEmergence{T} &lt;: AbstractOrgan_EmergenceModel
    TT_emergence::T
    carbon_internode_creation_cost::T
    leaf_surface_area::T
    leaves_max_surface_area::T
    water_leaf_threshold::T
end

ToyCustomInternodeEmergence(;TT_emergence=300.0, carbon_internode_creation_cost=200.0, leaf_surface_area=3.0,leaves_max_surface_area=100.0,
water_leaf_threshold=30.0) = ToyCustomInternodeEmergence(TT_emergence, carbon_internode_creation_cost, leaf_surface_area, leaves_max_surface_area, water_leaf_threshold)

PlantSimEngine.inputs_(m::ToyCustomInternodeEmergence) = (TT_cu=0.0,water_stock=0.0, carbon_stock=0.0)
PlantSimEngine.outputs_(m::ToyCustomInternodeEmergence) = (TT_cu_emergence=0.0, carbon_organ_creation_consumed=0.0)

function PlantSimEngine.run!(m::ToyCustomInternodeEmergence, models, status, meteo, constants=nothing, sim_object=nothing)

    leaves_surface_area = m.leaf_surface_area * get_n_leaves(status.node)
    status.carbon_organ_creation_consumed = 0.0

    if leaves_surface_area &gt; m.leaves_max_surface_area
        return nothing
    end

    # 如果水分库存不足，则优先生长根系，节间和叶不会发生
    if status.water_stock &lt; m.water_leaf_threshold
        return nothing
    end

    # 如果碳库存不足，不发生新器官生成
    if status.carbon_stock &lt; m.carbon_internode_creation_cost
        return nothing
    end

    if length(MultiScaleTreeGraph.children(status.node)) == 2 &amp;&amp;
        status.TT_cu - status.TT_cu_emergence &gt;= m.TT_emergence
        status_new_internode = add_organ!(status.node, sim_object, &quot;&lt;&quot;, &quot;Internode&quot;, 2, index=1)
        add_organ!(status_new_internode.node, sim_object, &quot;+&quot;, &quot;Leaf&quot;, 2, index=1)
        add_organ!(status_new_internode.node, sim_object, &quot;+&quot;, &quot;Leaf&quot;, 2, index=1)

        status_new_internode.TT_cu_emergence = m.TT_emergence - status.TT_cu
        status.carbon_organ_creation_consumed = m.carbon_internode_creation_cost
    end

    return nothing
end</code></pre><h2 id="更新映射关系"><a class="docs-heading-anchor" href="#更新映射关系">更新映射关系</a><a id="更新映射关系-1"></a><a class="docs-heading-anchor-permalink" href="#更新映射关系" title="Permalink"></a></h2><p>资源储存和节间生成模型现在需要额外几个与水分相关的映射变量。 “根（Root）”器官被加入到映射中，并配有其专属模型。同时需要初始化一些新的参数。</p><pre><code class="language-julia hljs">mapping = Dict(
&quot;Scene&quot; =&gt; ToyDegreeDaysCumulModel(),
&quot;Plant&quot; =&gt; (
    MultiScaleModel(
        model=ToyStockComputationModel(),
        mapped_variables=[
            :carbon_captured=&gt;[&quot;Leaf&quot;],
            :water_absorbed=&gt;[&quot;Root&quot;],
            :carbon_root_creation_consumed=&gt;[&quot;Root&quot;],
            :carbon_organ_creation_consumed=&gt;[&quot;Internode&quot;]

        ],
        ),
        Status(water_stock = 0.0, carbon_stock = 0.0)
    ),
&quot;Internode&quot; =&gt; (
        MultiScaleModel(
        model=ToyCustomInternodeEmergence(), # TT_emergence=20.0
        mapped_variables=[
            :TT_cu =&gt; &quot;Scene&quot;,
            PreviousTimeStep(:water_stock)=&gt;&quot;Plant&quot;,
            PreviousTimeStep(:carbon_stock)=&gt;&quot;Plant&quot;
        ],
        ),
        Status(carbon_organ_creation_consumed=0.0),
    ),
&quot;Root&quot; =&gt; (
        MultiScaleModel(
        model=ToyRootGrowthModel(10.0, 50.0, 10),
        mapped_variables=[
            PreviousTimeStep(:carbon_stock)=&gt;&quot;Plant&quot;,
            PreviousTimeStep(:water_stock)=&gt;&quot;Plant&quot;
        ],
        ),
        ToyWaterAbsorptionModel(),
        Status(carbon_root_creation_consumed=0.0, root_water_assimilation=1.0),
    ),
&quot;Leaf&quot; =&gt; ( ToyLeafCarbonCaptureModel(),),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Any} with 5 entries:
  &quot;Internode&quot; =&gt; (MultiScaleModel{ToyCustomInternodeEmergence{Float64}, Vector{…
  &quot;Root&quot;      =&gt; (MultiScaleModel{ToyRootGrowthModel{Float64}, Vector{Pair{Unio…
  &quot;Scene&quot;     =&gt; ToyDegreeDaysCumulModel(0.0, 10.0, 43.0)
  &quot;Plant&quot;     =&gt; (MultiScaleModel{ToyStockComputationModel, Vector{Pair{Union{S…
  &quot;Leaf&quot;      =&gt; (ToyLeafCarbonCaptureModel(),)</code></pre><h2 id="运行模拟"><a class="docs-heading-anchor" href="#运行模拟">运行模拟</a><a id="运行模拟-1"></a><a class="docs-heading-anchor-permalink" href="#运行模拟" title="Permalink"></a></h2><p>运行这个新的模拟过程和之前几乎一样。气象数据没有变化，但是在MTG中新增了一个“Root（根）”节点。</p><pre><code class="language-julia hljs">mtg = MultiScaleTreeGraph.Node(MultiScaleTreeGraph.NodeMTG(&quot;/&quot;, &quot;Scene&quot;, 1, 0))
    plant = MultiScaleTreeGraph.Node(mtg, MultiScaleTreeGraph.NodeMTG(&quot;+&quot;, &quot;Plant&quot;, 1, 1))

    internode1 = MultiScaleTreeGraph.Node(plant, MultiScaleTreeGraph.NodeMTG(&quot;/&quot;, &quot;Internode&quot;, 1, 2))
    MultiScaleTreeGraph.Node(internode1, MultiScaleTreeGraph.NodeMTG(&quot;+&quot;, &quot;Leaf&quot;, 1, 2))
    MultiScaleTreeGraph.Node(internode1, MultiScaleTreeGraph.NodeMTG(&quot;+&quot;, &quot;Leaf&quot;, 1, 2))

    internode2 = MultiScaleTreeGraph.Node(internode1, MultiScaleTreeGraph.NodeMTG(&quot;&lt;&quot;, &quot;Internode&quot;, 1, 2))
    MultiScaleTreeGraph.Node(internode2, MultiScaleTreeGraph.NodeMTG(&quot;+&quot;, &quot;Leaf&quot;, 1, 2))
    MultiScaleTreeGraph.Node(internode2, MultiScaleTreeGraph.NodeMTG(&quot;+&quot;, &quot;Leaf&quot;, 1, 2))

    plant_root_start = MultiScaleTreeGraph.Node(
        plant,
        MultiScaleTreeGraph.NodeMTG(&quot;+&quot;, &quot;Root&quot;, 1, 3),
    )

meteo_day = CSV.read(joinpath(pkgdir(PlantSimEngine), &quot;examples/meteo_day.csv&quot;), DataFrame, header=18)

outs = run!(mtg, mapping, meteo_day)
mtg</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Scene
└─ + 2: Plant
   ├─ / 3: Internode
   │  ├─ + 4: Leaf
   │  ├─ + 5: Leaf
   │  └─ &lt; 6: Internode
   │     ├─ + 7: Leaf
   │     ├─ + 8: Leaf
   │     └─ &lt; 19: Internode
   │        ├─ + 20: Leaf
   │        ├─ + 21: Leaf
   │        └─ &lt; 22: Internode
   │           ├─ + 23: Leaf
   │           ├─ + 24: Leaf
   │           └─ &lt; 25: Internode
   │              ├─ + 26: Leaf
   │              ├─ + 27: Leaf
   │              └─ &lt; 28: Internode
   │                 ├─ + 29: Leaf
   │                 ├─ + 30: Leaf
   │                 └─ &lt; 31: Internode
   │                    ├─ + 32: Leaf
   │                    ├─ + 33: Leaf
   │                    └─ &lt; 34: Internode
…</code></pre><p>就这样了吗！</p><p>……真的如此吗？</p><p>如果你仔细检查代码和输出结果，会发现模拟的运行方式存在一些明显的问题……有些地方似乎不太对劲。如果你想了解更多内容，请阅读下一章：<a href="multiscale_example_3.html#修复植物模拟中的Bug">修复植物模拟中的Bug</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="multiscale_example_1.html">« 简单植株模拟</a><a class="docs-footer-nextpage" href="multiscale_example_3.html">修复植株模拟中的错误 »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 10 January 2026 19:41">Saturday 10 January 2026</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
