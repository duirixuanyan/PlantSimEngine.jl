# 为什么选择使用 Julia

PlantSimEngine 是用 Julia 语言实现的。它的诞生源自一系列 [需求与要求](why_plantsimengine.md)，这些恰好是 Julia 能够有效满足的。

其他建模框架、FSPM 和作物模型往往是用 Java、C++、Python 或 Fortran 等多种语言的组合实现的。鉴于 Julia 目前还不是多数研究人员（甚至开发者！）最为熟悉的语言，因此本页简要解释了我们选择 Julia 的理由。另一个不错的资源是 Alejandro Morales Sierra（Virtual Plant Lab 的创始人和维护者）在 [discourse 上的帖子](https://fspm.discourse.group/t/why-is-julia-meant-for-fspm/175)。

## 从科研到实际应用

PlantSimEngine 最初是一个面向目标的框架。其特性是为应对日益复杂的仿真需求而产生——并持续不断地发展和优化。

虽然 PlantSimEngine 主要帮助研究人员高效地原型开发和测试模型，但我们始终以推动其在实际应用中发挥作用为愿景。我们的目标是建立学术植物建模与实际田间应用之间的桥梁。理想情况下，研究者能在舒适环境下开发和完善自己的模型，并最终能将这些模型部署到生产环境中。

这种双重功能的愿景促使我们高度重视性能优化。我们希望你开发的模型不仅仅止步于学术论文，还能在对效率和准确性要求极高的实际场景下可靠运行。Julia 强大的性能特性为这种愿景提供了其他语言难以匹敌的支撑。

PlantSimEngine 致力于在科学严谨性与开发效率之间取得平衡，长期目标是确保模型可以大规模部署。Julia 为研究人员提供了能够直接用代码表达复杂数学思想的环境，而且性能出色，为模型走向实际应用铺平道路。

## PlantSimEngine 的约束条件

### 性能

虽然在过去几十年中，计算机的算力与内存已经提升了好几个数量级，以至于许多曾经的性能瓶颈都已消失，但性能依然可能成为限制因素。

在许多植物个体、数以万计的叶片上，用用户自定义变量来模拟多个过程，需要大量的计算。如果使用如 Python 或 R 这样的高级语言，仿真所需时间并不理想。

事实上，最初决定转向 Julia 的部分动力，正是来自于将 [一个模型](https://github.com/VEZY/DynACof.jl) 从 R 移植到 Julia 后，性能实现了数量级的提升。“开箱即用”的情况下，原本需要数分钟的运算变成了几秒钟，更加确信了选择（参见[此基准测试](https://vezy.github.io/PlantBiophysics-paper/notebooks_performance_Fig5_PlantBiophysics_performance/)，性能相差高达 5 个数量级）。

Julia 拥有优良的 “即时（Just-ahead-of-time）编译” 模型，同时又可以灵活进行底层优化，因此不会像只用 Python 或 R 时遇到那样的限制。

### 灵活性与易用性

PlantSimEngine 的开发初衷之一，就是让假设检验变得简单。目前，验证 FSPM、作物模型或生态生理学机制的假设，在许多现有框架中都非常困难——要么结构过于僵硬，要么学习门槛太高。

同样地，在开发一个功能齐全的 FSPM 时，难免要针对某个过程测试不同模型，或用更复杂的模型进行替换。这时，API 友好与语言易用性，与自动化模型耦合一样重要，有助于保证这些变更顺畅地进行。

### 面向更广泛社区的包

如前所述，PlantSimEngine 面向的是大众用户，其中只有很少部分具备扎实开发背景。更多的潜在用户可能是精通生态生理学或植物结构的研究者，他们只会一些 Python、Matlab 或 R。降低这类用户的使用门槛尤为重要。

开源库/包、易于安装和低入门门槛，同样是我们决策时的重要参考。

### 保持性能的同时兼具模块化与灵活性

一种常用做法，是将如 Python 这样的灵活语言与高性能语言（如 C++、Fortran）结合：用慢但灵活的语言做原型开发，当需要性能时再用更高效的语言重写部分代码。

这种方式虽然满足性能要求，但也有不少缺点。

### 开发资源有限

当然，预算、时间和人力资源也是现实要素。研究者和建模者越能独立开发、越少依赖专业开发或工程资源，项目的可持续发展性也就越强。

## 对比

### “两种语言”问题

将两种不同的语言结合使用需要大量的语言知识，并且经常需要不断温习，因为在实际开发中，只有偶尔才会用到并调试底层语言。同时会消耗更多的工程资源。

而每当性能成为瓶颈时，开发和迭代的速度就会下降，这在我们的应用场景下非常常见。即使像 Python 这样模块化且易用的语言，也会在需要切换到低级语言实现时让开发节奏变慢。

Julia 有效地解决了这一难题。虽然它的学习曲线比 Python 略高，并需要额外的知识去充分发挥其灵活性和性能优势，但整体上能带来更流畅的开发体验。

所有工作都可以仅用 Julia 完成，无需再掌握两种语言，也无需处理它们之间的接口问题。即使需要底层实现，开发的迭代速度也不会突然停滞。具备一定技能的研究者/开发者可以毫无障碍地从原型开发过渡到实际生产，同时还能专注于建模和植物本身的科学问题。

![不同机器学习包的语言占比对比（图片来源：https://pde-on-gpu.vaw.ethz.ch/lecture1/）](../www/l1_flux-vs-tensorflow.png)
（不同机器学习包的语言使用对比，来源：https://pde-on-gpu.vaw.ethz.ch/lecture1/）

显然，并不只有我们发现 Julia 是解决该类问题的重要工具。Julia 正在越来越多的细分领域获得认可，尤其是那些计算密集型且研究活跃的领域，如机器学习和气候建模——这些场景中对表达能力和性能的平衡同样至关重要。

### 易用性兼顾的良好平衡

另一个选择 Julia 的理由是，PlantSimEngine 旨在让希望验证假设或复现其他论文结果的研究者能够方便使用。当运行和修改仿真的门槛更低时，科学复现性也会大大提升。

许多研究人员并非职业开发者，纯用 Java 或 C++ 实现的模型，不仅难以上手，也难以获得广泛采用。

尽管 Julia 在学术圈还不如其他语言普及，但它的语法风格更接近 Python 和 R，比 Java、C++ 更加友好，对初学者而言也更易入门。Python 用户学习简单的 Julia 包，显然比学 C++ 容易得多。

用户实现新模型时，不需要担心底层实现或跨语言接口等潜在障碍，可以专注于快速试验——原型阶段无需额外花时间进行性能优化。

### 环境搭建便利

同样，Julia 本身的环境和包管理非常简单直观，不需要额外的知识。

Julia 内置的包管理器极大地简化了依赖管理。对于科学工作流程的可复现性而言，这一点非常重要——保持一致的运行环境是关键。

### 可接受的不足

Julia 对“研究者-开发者”来说非常实用，但它当然不是各个领域的完美语言。Julia 拥有丰富的语言特性，运行时较重，要快速掌握和精通也比 Python 困难。对于初学者来说有一些门槛，对开发者来说也存在一些不够成熟的工具和奇怪的地方，还没有特别标准推荐的“正确工作流”等等。

在很多其他环境下，转向 Julia 可能并不划算。然而，这些缺点在嵌入式系统或游戏开发等场景中很重要，但对 PlantSimEngine 而言却大多不构成障碍。其他问题则完全可以通过完善的文档和学习资源加以缓解。

## 总结

对于 PlantSimEngine 的具体需求而言——兼顾性能与灵活性、在保证计算效率的同时实现快速迭代，以及为科研人员和实际从业者提供友好易用的界面——Julia 是非常合适的选择。这门语言使我们能够构建一个高效协作、科学严谨且面向生产部署的生态系统，从而推动植物建模的进步并为实际应用带来价值。

当然，没有哪种编程语言是十全十美的，但 Julia 独特的特性组合，使其非常适合应对现代植物建模与仿真的挑战，无论是在科学研究还是实际应用中。我们对 Julia 在植物建模未来所展现的潜力，充满信心。
