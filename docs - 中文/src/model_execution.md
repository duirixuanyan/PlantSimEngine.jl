# 模型执行

## 仿真顺序

`PlantSimEngine.jl` 利用 [`ModelList`](@ref) 自动计算模型之间的依赖图，并以正确的顺序运行仿真。在使用 [`run!`](@ref) 运行仿真时，模型的执行遵循以下简单规则：

1. 首先运行独立模型。若某一模型可以独立于其他模型执行，仅依赖初始化（或不依赖任何内容），则称其为独立模型。
2. 接下来，运行依赖于其他模型的模型。首先运行那些依赖于独立模型的模型，然后依次运行它们的子模型，再进一步运行它们的子模型……如此递归，直到再也没有子模型可运行。子模型（即依赖关系）分为两类：强依赖和弱依赖：
   1. 强依赖总是先于弱依赖被执行。强依赖指的是被其它模型直接调用的模型。其父模型会将其列为 `dep`，以声明为强依赖。参见[此示例](https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/3d91bb053ddbd087d38dcffcedd33a9db35a0fcc/examples/dummy.jl#L39)，其中 `Process2Model` 定义了对模拟 `process1` 的模型的强依赖。
   2. 弱依赖则按顺序依次执行。如果某模型的一个或多个输入由其他模型计算，则它对这些模型属于弱依赖。若一个弱依赖有多个父节点（例如，两个不同模型分别计算了它的两个输入），则该模型只有在所有父节点都已运行后才会被执行。实际操作中，当访问某个节点时，如果它的某个父节点尚未执行，则该分支的访问会被中止。最终该节点会从最后一个已执行的父节点所在分支被访问与执行。
